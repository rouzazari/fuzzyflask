{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block scripts %}
{{ super() }}
{% endblock %}

{% block title %}Fuzzy Flask{% endblock %}

{% block page_content %}
  <div>
    {# Animation via ngAnimate + angular-ui/bootstrap,  https://github.com/angular-ui/bootstrap/tree/master/src/collapse #}
    <form class="form-horizontal" role="form" ng-submit="app.sendData()" uib-collapse="isFormCollapsed">
      {# Create form by hand as opposed to using wtf.quick_form() #}
      {# this allows sending in parameters to #}
      {# source: https://pythonhosted.org/Flask-Bootstrap/forms.html #}
      {{ data_form.csrf_token }}
      <div class="form-group">
        <div class="form-group row">
          <div class="col-md-4 col-md-offset-1">
            {{ wtf.form_field(data_form.dataset, ng_model="form.dataset", placeholder="Paste single-column data here...", rows="10") }}
          </div>
          <div class="col-md-4 col-md-offset-1">
            {{ wtf.form_field(data_form.dictionary, ng_model="form.dictionary", placeholder="Paste dictionary here...", rows="10") }}
          </div>
        </div>
      </div>
      <div class="col-md-11 col-centered">
        {{ wtf.form_field(data_form.submit) }}
      </div>
    </form>
    {# button only shows when form hidden #}
    <div class="ng-cloak col-centered" ng-show="isFormCollapsed">
      <button type="button" class="btn btn-default ng-cloak" ng-click="isFormCollapsed = !isFormCollapsed">Show search form</button>
    </div>
    {# use ng-cloak and css file to avoid flicker effect #}
    {# source: https://docs.angularjs.org/api/ng/directive/ngCloak #}
    <div class="ng-cloak" ng-show="isRunning">
      {# TODO: upgrade to progress bar https://github.com/angular-ui/bootstrap/tree/master/src/progressbar #}
      <div>{a status_text a}</div>
      <button class="btn btn-default" ng-click="app.stopMatch()">Stop <i class="fa fa-hand-paper-o" aria-hidden="true"></i></button>
    </div>
    {# using ng-csv to export file: https://github.com/asafdav/ng-csv #}
    {# TODO: add column headers #}
    <div id="save-btn" class="ng-cloak" ng-show="dataframe.length">
      <button class="btn btn-default"  ng-csv="dataframe" filename="test.csv">Save to CSV <i class="fa fa-file-excel-o"></i></button>
    </div>
    <table class="ng-cloak" ng-show="dataframe.length">
      <thead>
        <tr>
          <th>Input</th>
          <th>Match</th>
          <th>Score</th>
          <th>Accept?</th>
          <th>Edit</th>
        </tr>
      </thead>
      {# Partially adapted from http://ng-table.com/#/editing/demo-inline #}
      <tr ng-repeat="row in dataframe" ng-form="rowForm">
        <td><span>{a row.data a}</span></td>
        <td ng-switch="row.isEditing">
          <span ng-switch-default>{a row.match a}</span>
          <div ng-switch-when="true">
            <select ng-model="row.match" ng-options="o as o for o in dictionary" required class="btn"></select>
          </div>
        </td>
        <td><span>{a row.score a}</span></td>
        <td><input type="checkbox" ng-model="row.selected"></td>
        {# TODO: research if dropdown works: https://github.com/angular-ui/bootstrap/tree/master/src/dropdown#}
        <td>
          <button class="btn btn-primary btn-sm" ng-click="app.save(row, rowForm)" ng-if="row.isEditing"><span class="glyphicon glyphicon-ok"></span></button>
          <button class="btn btn-default btn-sm" ng-click="row.isEditing = true" ng-if="!row.isEditing"><span class="glyphicon glyphicon-pencil"></span></button>
        </td>
      </tr>
    </table>
  </div>
{% endblock %}

